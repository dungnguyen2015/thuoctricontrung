(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[667],{8563:function(e,t,a){Promise.resolve().then(a.bind(a,1206))},1206:function(e,t,a){"use strict";a.d(t,{default:function(){return l}});var s=a(7437),n=a(2265),i=a(7648);function r(e){let{initialValue:t=1,postId:a}=e,[i,r]=(0,n.useState)(t),[l,c]=(0,n.useState)(!1),d=async e=>{let t=Number(e.target.value);r(t),c(!0);try{let e=await fetch("/api/posts/update-visible",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a,visible:t})}),s=await e.json();e.ok&&s.success||alert("Cập nhật thất bại!")}catch(e){console.error(e),alert("Lỗi kết nối m\xe1y chủ!")}finally{c(!1)}};return(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("select",{value:i,onChange:d,className:"border rounded px-3 py-2 transition-colors duration-200 ".concat(1===i?"bg-green-100 text-green-800 border-green-400":"bg-red-100 text-red-800 border-red-400"),disabled:l,children:[(0,s.jsx)("option",{value:0,children:"Ẩn"}),(0,s.jsx)("option",{value:1,children:"Hiện"}),(0,s.jsx)("option",{value:2,children:"Đang chờ"})]}),l&&(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Đang cập nhật..."})]})}function l(){let[e,t]=(0,n.useState)([]),[a,l]=(0,n.useState)(1),[c,d]=(0,n.useState)({total:0,limit:20,totalPages:0});(0,n.useEffect)(()=>{fetch("/api/admin/posts?page=".concat(a,"&limit=").concat(c.limit)).then(e=>e.json()).then(e=>{t(e.data),d(e.pagination)})},[a]);let o=async a=>{if(confirm("Bạn c\xf3 chắc muốn x\xf3a b\xe0i viết n\xe0y?"))try{let s=await fetch("/api/posts/".concat(a),{method:"DELETE",headers:{"Content-Type":"application/json"}}),n=await s.json();n.success?(alert("X\xf3a th\xe0nh c\xf4ng!"),t(e.filter(e=>e.id!==a))):alert("Lỗi khi x\xf3a: ".concat(n.message||"Kh\xf4ng r\xf5 lỗi"))}catch(e){alert("Xảy ra lỗi khi kết nối đến server.")}};return(0,s.jsxs)("div",{className:"overflow-x-auto",children:[(0,s.jsx)(i.default,{href:"/admin/posts/new",className:"bg-blue-600 text-white px-4 py-2 rounded mb-4 inline-block",children:"+ Tạo b\xe0i viết"}),(0,s.jsxs)("table",{className:"w-full table-auto border",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-gray-100 text-left",children:[(0,s.jsx)("th",{className:"p-2 border",children:"#"}),(0,s.jsx)("th",{className:"p-2 border",children:"Ti\xeau đề"}),(0,s.jsx)("th",{className:"p-2 border",children:"Ảnh"}),(0,s.jsx)("th",{className:"p-2 border",children:"Ẩn/Hiện"}),(0,s.jsx)("th",{className:"p-2 border",children:"H\xe0nh động"})]})}),(0,s.jsx)("tbody",{children:e.map((e,t)=>(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"p-2 border",children:t+1}),(0,s.jsx)("td",{className:"p-2 border",children:(0,s.jsx)(i.default,{href:"/admin/posts/".concat(e.id),className:"text-blue-600",children:e.title})}),(0,s.jsx)("td",{className:"p-2 border",children:e.image_url&&(0,s.jsx)("img",{src:e.image_url,width:"100px",className:"h-16 object-cover"})}),(0,s.jsx)("td",{className:"p-2 border",children:(0,s.jsx)(r,{initialValue:e.visible,postId:e.id})}),(0,s.jsxs)("td",{className:"p-2 border",children:[(0,s.jsx)(i.default,{href:"/admin/posts/".concat(e.id),className:"text-blue-600 mr-2",children:"Sửa"}),(0,s.jsx)("button",{onClick:()=>o(e.id),className:"text-red-600",children:"X\xf3a"})]})]},e.id))})]}),(0,s.jsxs)("div",{className:"flex gap-2 mt-4 text-right",children:[(0,s.jsx)("button",{className:"text-blue-600",onClick:()=>l(e=>Math.max(1,e-1)),disabled:a<=1,children:"Trang trước"}),(0,s.jsxs)("span",{children:["Trang ",a," / ",c.totalPages]}),(0,s.jsx)("button",{className:"text-blue-600",onClick:()=>l(e=>Math.min(c.totalPages,e+1)),disabled:a>=c.totalPages,children:"Trang sau"})]})]})}},7648:function(e,t,a){"use strict";a.d(t,{default:function(){return n.a}});var s=a(2972),n=a.n(s)}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=8563)}),_N_E=e.O()}]);