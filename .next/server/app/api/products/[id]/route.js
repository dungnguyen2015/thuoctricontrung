(()=>{var e={};e.id=898,e.ids=[898],e.modules={62849:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=62849,e.exports=t},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},20629:e=>{"use strict";e.exports=require("fs/promises")},98216:e=>{"use strict";e.exports=require("net")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},95346:e=>{"use strict";e.exports=require("timers")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},8754:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>y,requestAsyncStorage:()=>_,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var i={};r.r(i),r.d(i,{DELETE:()=>g,GET:()=>l,PUT:()=>E});var s=r(49303),a=r(88716),o=r(60670),c=r(9487),u=r(87070);r(71159);var n=r(20629),p=r(55315),d=r.n(p);async function l(e,{params:t}){let{id:r}=await t,i=await (0,c.I)("SELECT * FROM products WHERE id = ?",[r]);return u.NextResponse.json(i[0])}async function E(e,{params:t}){let r=await e.json(),i=await c.db.getConnection();try{await i.beginTransaction();let e=`
      UPDATE products SET 
        name = ?, 
        slug = ?,
        content = ?, 
        ingredients = ?, 
        description = ?, 
        status = ?,
        price = ?,
        updated_at = ?
      WHERE id = ?
    `;if(await i.query(e,[r.name,r.slug,r.content,JSON.stringify(r.ingredients),r.description,r.status,r.capacities[0].price,r.updated_at,r.id]),await i.query("DELETE FROM product_capacities WHERE product_id = ?",[r.id]),r.capacities.length>0){let e=r.capacities.map(e=>[r.id,e.capacity,e.price,e.discount_price,e.in_stock?1:0]),t=`
        INSERT INTO product_capacities 
          (product_id, capacity, price, discount_price, in_stock) 
        VALUES ?
      `;await i.query(t,[e])}if(await i.query("DELETE FROM product_images WHERE product_id = ?",[r.id]),r.images.length>0){let e=r.images.map(e=>[r.id,e,e===r.primary_image?1:0]),t=`
        INSERT INTO product_images 
          (product_id, image_url, is_primary) 
        VALUES ?
      `;await i.query(t,[e])}if(r.categories&&r.categories.length>0&&(await i.query("DELETE FROM category_product WHERE product_id = ?",[r.id]),r.categories.length>0)){let e=r.categories.map(e=>[e.category_id,r.id]),t=`
          INSERT INTO category_product 
            (category_id, product_id) 
          VALUES ?
        `;await i.query(t,[e])}return await i.commit(),u.NextResponse.json({success:!0,message:"Cập nhật sản phẩm th\xe0nh c\xf4ng"})}catch(e){return await i.rollback(),console.error("Lỗi khi cập nhật sản phẩm:",e),u.NextResponse.json({success:!1,message:"Cập nhật sản phẩm thất bại"},{status:500})}finally{i.release()}}async function g(e,{params:t}){let{id:r}=await t;if(!/^\d+$/.test(r))return u.NextResponse.json({error:"Invalid ID format"},{status:400});try{let[e]=await (0,c.I)("SELECT image_url FROM product_images WHERE product_id = ?",[r]);for(let t=0;t<e.length;t++)if(""!=e.image_url){let t=d().join(process.cwd(),"uploads",e.image_url.replace(/^\/uploads\//,""));await (0,n.unlink)(t)}await (0,c.I)("DELETE FROM product_images WHERE product_id = ?",[r]),await (0,c.I)("DELETE FROM product_capacities WHERE product_id = ?",[r]);let t=await (0,c.I)("DELETE FROM products WHERE id = ?",[r]);return u.NextResponse.json({success:!0,result:t})}catch(e){return u.NextResponse.json({success:!1,message:"Error deleting post"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/products/[id]/route",pathname:"/api/products/[id]",filename:"route",bundlePath:"app/api/products/[id]/route"},resolvedPagePath:"D:\\VPS-Dung\\thuoctricontrung\\app\\api\\products\\[id]\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:_,staticGenerationAsyncStorage:h,serverHooks:x}=m,R="/api/products/[id]/route";function y(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},9487:(e,t,r)=>{"use strict";r.d(t,{I:()=>s,db:()=>i});let i=r(69518).createPool({host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"root",password:process.env.DB_PASS||"",database:process.env.DB_NAME||"trungdienlanh",waitForConnections:!0,connectionLimit:20,queueLimit:100,enableKeepAlive:!0,keepAliveInitialDelay:3e4});async function s(e,t){{let[r]=await i.execute(e,t);return r}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[948,827,972],()=>r(8754));module.exports=i})();