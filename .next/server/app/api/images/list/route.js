(()=>{var t={};t.id=97,t.ids=[97],t.modules={62849:t=>{function e(t){var e=Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=62849,t.exports=e},20399:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:t=>{"use strict";t.exports=require("buffer")},84770:t=>{"use strict";t.exports=require("crypto")},17702:t=>{"use strict";t.exports=require("events")},98216:t=>{"use strict";t.exports=require("net")},35816:t=>{"use strict";t.exports=require("process")},76162:t=>{"use strict";t.exports=require("stream")},74026:t=>{"use strict";t.exports=require("string_decoder")},95346:t=>{"use strict";t.exports=require("timers")},82452:t=>{"use strict";t.exports=require("tls")},17360:t=>{"use strict";t.exports=require("url")},21764:t=>{"use strict";t.exports=require("util")},71568:t=>{"use strict";t.exports=require("zlib")},74208:(t,e,r)=>{"use strict";r.r(e),r.d(e,{originalPathname:()=>E,patchFetch:()=>y,requestAsyncStorage:()=>_,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var i={};r.r(i),r.d(i,{GET:()=>d,dynamic:()=>u,runtime:()=>p});var s=r(49303),a=r(88716),o=r(60670),c=r(87070),n=r(69157);let u="force-dynamic",p="nodejs";async function d(t){try{let{searchParams:e}=new URL(t.url),r=parseInt(e.get("page")||"1"),i=parseInt(e.get("limit")||"5"),s=(r-1)*i,a=await (0,n.VL)({offset:s,limit:i}),o=await (0,n.zT)(),u=c.NextResponse.json({images:a,pagination:{page:r,limit:i,total:o,totalPages:Math.ceil(o/i)}});return u.headers.set("Cache-Control","no-store"),u}catch(t){return console.log(t),c.NextResponse.json({error:"Something went wrong"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/images/list/route",pathname:"/api/images/list",filename:"route",bundlePath:"app/api/images/list/route"},resolvedPagePath:"D:\\VPS-Dung\\thuoctricontrung\\app\\api\\images\\list\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:_,staticGenerationAsyncStorage:g,serverHooks:m}=l,E="/api/images/list/route";function y(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},69157:(t,e,r)=>{"use strict";r.d(e,{Bd:()=>s,Dg:()=>u,VL:()=>a,bO:()=>c,eU:()=>o,zT:()=>n});var i=r(9487);async function s({offset:t=0,limit:e=10}){let r="string"==typeof e?parseInt(e,10):e,s="string"==typeof t?parseInt(t,10):t,a=`SELECT * FROM posts ORDER BY created_at DESC LIMIT ${r} OFFSET ${s}`;return await (0,i.I)(a)}async function a({offset:t=0,limit:e=10}){let r="string"==typeof e?parseInt(e,10):e,s="string"==typeof t?parseInt(t,10):t,a=`SELECT * FROM images ORDER BY id DESC LIMIT ${r} OFFSET ${s}`;return await (0,i.I)(a)}async function o(){return(await (0,i.I)("SELECT COUNT(*) as count FROM posts"))[0].count}async function c(){return(await (0,i.I)("SELECT COUNT(*) as count FROM products"))[0].count}async function n(){return(await (0,i.I)("SELECT COUNT(*) as count FROM images"))[0].count}async function u({offset:t=0,limit:e=10}){try{let r=`SELECT * FROM products
       ORDER BY created_at DESC
       LIMIT ${e} OFFSET ${t}`,s=await (0,i.I)(r);if(0===s.length)return[];let a=s.map(t=>t.id),o=await (0,i.I)(`SELECT product_id, image_url, is_primary 
       FROM product_images 
       WHERE product_id IN (${a})`),c=await (0,i.I)(`SELECT category_id, product_id 
       FROM category_product 
       WHERE product_id IN (${a})`),n=await (0,i.I)(`SELECT product_id, capacity, price, discount_price, in_stock 
       FROM product_capacities 
       WHERE product_id IN (${a})`),u={};o.forEach(t=>{u[t.product_id]||(u[t.product_id]=[]),u[t.product_id].push(t)});let p={};c.forEach(t=>{p[t.product_id]||(p[t.product_id]=[]),p[t.product_id].push(t)});let d={};return n.forEach(t=>{d[t.product_id]||(d[t.product_id]=[]),d[t.product_id].push(t)}),s.map(t=>{let e=u[t.id]||[],r=d[t.id]||[],i=p[t.id]||[],s=e.find(t=>t.is_primary)||e[0],a=r.map(t=>({capacity:t.capacity,price:t.price,discount_price:t.discount_price??t.price,in_stock:!!t.in_stock})),o=i.map(t=>({category_id:t.category_id,product_id:t.product_id}));return{id:t.id,name:t.name,slug:t.slug,content:t.content,ingredients:JSON.parse(t.ingredients||"[]"),description:t.description,status:t.status,created_at:t.created_at,primary_image:s?.image_url||null,images:e.map(t=>t.image_url),capacities:a,first_capacity:r[0]?.capacity||null,first_price:r[0]?.price||0,first_discount_price:r[0]?.discount_price||r[0]?.price||0,categories:o}})}catch(t){return console.error("Lỗi truy vấn sản phẩm",t),[]}}},9487:(t,e,r)=>{"use strict";r.d(e,{I:()=>s,db:()=>i});let i=r(69518).createPool({host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"root",password:process.env.DB_PASS||"",database:process.env.DB_NAME||"trungdienlanh",waitForConnections:!0,connectionLimit:20,queueLimit:100,enableKeepAlive:!0,keepAliveInitialDelay:3e4});async function s(t,e){{let[r]=await i.execute(t,e);return r}}}};var e=require("../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),i=e.X(0,[948,827,972],()=>r(74208));module.exports=i})();